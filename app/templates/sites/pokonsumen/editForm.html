{% extends "layout/layout.html" %}

{% block head_css %}

<style>
    .sparepart_row{
        margin-top: 30px;
    }
</style>

{% endblock %}

{% block head_js %}
{% endblock %}

{% block body_content %}


<div class="block-header">
    <!-- If you do not want a link in the header, instead of .header-title-link you can use a div with the class .header-section -->
    <a href="" class="header-title-link">
        <h1>
            <i class="fa fa-cogs animation-expandUp"></i>PO Konsumen
            <br>
            <small>Edit Data</small>
        </h1>
    </a>
</div>
<ul class="breadcrumb breadcrumb-top">
    <li><i class="fa fa-pencil-square-o"></i></li>
    <li>PO Konsumen</li>
    <li>Edit Data</li>
</ul>

<a class="btn btn-primary" style="margin-bottom: 14px;" href="/pokonsumen"><i class="fa fa-arrow-left"></i> Kembali</a>

<div class="block full">
    <!-- Dropzone Title -->
    <div class="block-title">
        <h2>Form Edit Data</h2>
    </div>
    <!-- END Dropzone Title -->
    <form action="/pokonsumen/edit" name="form" method="post" enctype="multipart/form-data" class="form-horizontal" onsubmit="return validateForm()">
        <input type="text" id="id" name="id" class="form-control" value="{{ data.id }}" style="display:none;" >
        <h4 class="sub-header">Text Inputs</h4>
        <div class="form-group">
            <label class="col-md-2 control-label" for="seller">Quotation</label>
            <div class="col-md-3">
                {% for no, x in listQuotation %}
                    {% set number = data.quotation_id | int %}
                    {% if number == x.id %}
                        <input type="text" id="quotation_number" name="quotation_number" class="form-control" value="{{ x.quotation_number }}" readonly >
                        <input type="text" id="quotation" name="quotation" class="form-control" value="{{ x.id }}" style="display:none;" >
                    {% endif %}
                {% endfor %}
            </div>
        </div>
        <div class="form-group">
            <label class="col-md-2 control-label" for="seller">Seller</label>
            <div class="col-md-3">
                <input type="text" id="seller_name" name="seller_name" class="form-control" value="{{ data.seller_name }}" >
            </div>
        </div>
        <div class="form-group">
            <label class="col-md-2 control-label" for="reference">PO Reference</label>
            <div class="col-md-3">
                <input type="text" id="po_number" name="po_number" class="form-control" value="{{ data.po_number }}" >
            </div>
        </div>
        <div class="form-group">
            <label class="col-md-2 control-label" for="sparepart_number">Sparepart</label>
            <div class="col-md-10">
                <div class="col-sm-2">
                    <label class="head-dyn" for="sparepart">Sparepart:</label>
                </div>
                <div class="col-sm-1">
                </div>
                <div class="col-sm-1">
                    <label class="head-dyn" for="qty">Quantity:</label>
                </div>
                <div class="col-sm-2">
                    <label class="head-dyn" for="price">price:</label>
                </div>
                <div class="col-sm-2">
                    <label class="head-dyn" for="total_price">Total Price:</label>
                </div>
                <div class="col-sm-3">
                    <label class="head-dyn" for="price">description:</label>
                </div>
                <div class="col-sm-1">
                </div>
            </div>
        </div>
        <div class="sparepart-form">
        </div>
        <div class="sparepart-summary">
        </div>
        <div class="form-group">
            <div class="col-md-5 col-md-offset-2">
                <button type="reset" class="btn btn-default"><i class="fa fa-times"></i> Reset</button>
                <button type="submit" class="btn btn-primary"><i class="fa fa-arrow-right"></i> Submit</button>
            </div>
        </div>
    </form>
</div>


{% endblock %}

{% block body_js %}

<script>
    let max_fields      = 10; //maximum input boxes allowed
    let index = 1;
    let sparePartData
    getQuotation()
    actionForQuotation()

    function validateForm() {
        var x = document.forms["form"]["konsumen_id"].value;
        if (x == "") {
          alert("Form id konsumen tidak boleh kosong");
          return false;
        }
        var x = document.forms["form"]["konsumen_name"].value;
        if (x == "") {
          alert("Form nama konsumen tidak boleh kosong");
          return false;
        }
        var x = document.forms["form"]["konsumen_address"].value;
        if (x == "") {
          alert("Form alamat konsumen tidak boleh kosong");
          return false;
        }
        var x = document.forms["form"]["konsumen_phone"].value;
        if (x == "") {
          alert("Form telephone tidak boleh kosong");
          return false;
        }
    }

    // $( '.money-format' ).mask('000.000.000', {reverse: true});

    function setFinalPrice() {
        let sum = 0;
        $(".prc").each(function(){
            sum += +$(this).val()
        });
        $("#sum_price").val(sum);
        let fp = parseInt($("#sum_price").val())
        let ppn = 10
        let materai = parseInt($("#materai").val())
        let ppn_due = fp * (ppn/100);
        let grandprice = fp + ppn_due + materai

        $("#ppn").val(ppn_due);
        $("#grandprice").val(grandprice);

    }
    
    $(".sparepart-form").on("click",".remove-form-button", function(e){ //user click on remove text
        e.preventDefault(); $(this).parent('div').parent('div').parent('div').remove();
        setFinalPrice()
    })

    function setOption() {
        let html = ""
        for (i = 0; i < sparePartData.length; i++) {
            id = sparePartData[i].id
            sparepart_number = sparePartData[i].sparepart_number
            html += "<option value='"+ id +"'>"+ sparepart_number +"</option>"
        }
        return html
    }

    function getQuotation() {
        $.ajax({
            type:"GET",
            url:"http://administrator.teknikberlianjaya.com/master/quotation/1",
            success: function(data) {
                html = ""
                for (i = 0; i < data.length; i++) {
                    id = data[i].id
                    quotation_number = data[i].quotation_number
                    html += "<option value='"+ id +"'>"+ quotation_number +"</option>"
                }
                $('#quotation').append(html);              
            },
            dataType: 'json',
          });
        actionForQuotation()
    }

    function actionForQuotation() {    
        //$ ('#quotation').change(function(){ 
            let quot_id = $('#quotation').val()
            
            $.ajax({
            type:"GET",
            url:"http://administrator.teknikberlianjaya.com/master/quotationdetail/" + quot_id,
            success: function(data) {
                $(".sparepart-form").empty(); // clear boxes.
                $(".sparepart-summary").empty();
                for (index = 0; index < data.length; index++) {
                    let optionElement = '<div class="form-group">'
                        +'<label class="col-md-2 control-label" for="sparepart_number">-</label><div class="col-md-10">'
                        +'<div class="col-sm-3">'
                        +'    <input type="text" id="sparepart_'+ index +'" name="sparepart_'+ index +'" class="form-control" placeholder="sparepart" value ="'+ data[index].sparepart_name +'" readonly>'
                        +'</div>'
                        +'<div class="col-sm-1">'
                        +'    <input type="number" id="qty_'+ index +'" name="qty_'+ index +'" class="form-control" placeholder="qty" min="1" value ="'+ data[index].sparepart_qty +'" readonly>'
                        +'</div>'
                        +'<div class="col-sm-2">'
                        +'    <input type="text" id="price_'+ index +'" name="price_'+ index +'" class="form-control money-format" placeholder="price" value="'+ data[index].sparepart_price +'" readonly>'
                        +'</div>'
                        +'<div class="col-sm-2">'
                        +'    <input type="text" id="total_price_'+ index +'" name="total_price_'+ index +'" class="form-control money-format prc" placeholder="total price" value="'+ data[index].sparepart_totalprice +'" readonly>'
                        +'</div>'
                        +'<div class="col-sm-3">'
                        +'    <input type="text" id="description_'+ index +'" name="description_'+ index +'" class="form-control" placeholder="description" value="'+ data[index].sparepart_description +'" readonly>'
                        +'</div>'
                        +'</div>'
                        +'</div>'
        
                    $(".sparepart-form").append(optionElement);
                }

                let elementSummary = '<div class="form-group">'
                +'    <label class="col-md-2 control-label sparepart_row" for="sparepart_number"></label>'
                +'    <div class="col-md-10">'
                +'        <div class="col-sm-5">'
                +'        </div>'
                +'        <div class="col-sm-1">'
                +'            <label class="head-dyn" for="sum_price">Total Price:</label>'
                +'        </div>'
                +'        <div class="col-sm-2">'
                +'            <input type="text" id="sum_price" name="sum_price" class="form-control money-format" placeholder="final price" value="'+ data[0].quotation_price +'" readonly>'
                +'        </div>'
                +'        <div class="col-sm-1">'
                +'        </div>'
                +'    </div>'
                +'</div>'
                +'<div class="form-group">'
                +'    <label class="col-md-2 control-label sparepart_row" for="sparepart_number"></label>'
                +'    <div class="col-md-10">'
                +'        <div class="col-sm-5">'
                +'        </div>'
                +'        <div class="col-sm-1">'
                +'            <label class="head-dyn" for="ppn">PPN 10%:</label>'
                +'        </div>'
                +'        <div class="col-sm-2">'
                +'            <input type="text" id="ppn" name="ppn" class="form-control money-format" placeholder="ppn" value="'+ data[0].quotation_ppn +'" readonly>'
                +'        </div>'
                +'        <div class="col-sm-1">'
                +'        </div>'
                +'    </div>'
                +'</div>'
                +'<div class="form-group">'
                +'    <label class="col-md-2 control-label sparepart_row" for="sparepart_number"></label>'
                +'    <div class="col-md-10">'
                +'        <div class="col-sm-5">'
                +'        </div>'
                +'        <div class="col-sm-1">'
                +'            <label class="head-dyn" for="materai">Materai:</label>'
                +'        </div>'
                +'        <div class="col-sm-2">'
                +'            <input type="text" id="materai" name="materai" class="form-control money-format" placeholder="Materai" value="'+ data[0].quotation_materai +'" readonly>'
                +'        </div>'
                +'        <div class="col-sm-1">'
                +'        </div>'
                +'    </div>'
                +'</div>'
                +'<div class="form-group">'
                +'    <label class="col-md-2 control-label sparepart_row" for="sparepart_number"></label>'
                +'    <div class="col-md-10">'
                +'        <div class="col-sm-5">'
                +'        '
                +'        </div>'
                +'        <div class="col-sm-1">'
                +'            <label class="head-dyn" for="grandprice">Grand Price:</label>'
                +'        </div>'
                +'        <div class="col-sm-2">'
                +'            <input type="text" id="grandprice" name="grandprice" class="form-control money-format" placeholder="Grand Price" value="'+ data[0].quotation_totalprice +'" readonly>'
                +'        </div>'
                +'        <div class="col-sm-1">'
                +'        </div>'
                +'    </div>'
                +'</div>'
                
                $(".sparepart-summary").append(elementSummary);
                          
            },
                dataType: 'json',
            });
        // });
    }    

</script>

{% endblock %}